<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.2.xsd">

  <form name="invoice-line-form" title="Invoice line"
    model="com.axelor.gst.db.InvoiceLine" onSave="save">

    <panel title="Invoice Line Detail" name="invoiceLinePanel">
      <field name="product" onChange="action-record-set-product-fullname,action-record-invoce-line-set-product-gstrate"/>
      <field name="hsbn" />
      <field name="item"/>
      <field name="qty" />
      <field name="price" onChange="action-invoice-line-condition-check-product-is-empty,action-invoice-line-group-set-total-gst-amount"/>
      <field name="netAmount"/>
      <field name="gstRate" />
      <field name="igst" />
      <field name="sgst" />
      <field name="cgst" />
      <field name="grossAmount" />
    </panel>
  </form>

  <grid model="com.axelor.gst.db.InvoiceLine" title="Invoice Line" name="invoice-line-grid">
       <field name="product" />
      <field name="hsbn" />
      <field name="item" />
      <field name="qty" />
      <field name="price"/>
      <field name="netAmount"/>
      <field name="gstRate" />
      <field name="igst" />
      <field name="sgst" />
      <field name="cgst" />
      <field name="grossAmount" />
  </grid>

  <action-record name="action-record-set-product-fullname" model="com.axelor.gst.db.InvoiceLine">
  <field name="item" expr="eval:'['+ product.code +'] '+ product.name"/></action-record>

  <action-record name="action-record-invoce-line-set-product-gstrate" model="com.axelor.gst.db.InvoiceLine">
  <field name="gstRate" expr="eval:product.gstRate"/>
  </action-record>

  <action-record name="action-invoice-product-record-set-net-amount" model="com.axelor.gst.db.InvoiceLine">
  <field name="netAmount" expr="eval:qty * price" />
  </action-record>

  <action-method name="action-invoice-line-method-calculate-amounts" model="com.axelor.gst.db.InvoiceLine">
  <call class="com.axelor.gst.db.web.GstInvoiceController" method="calculateGst"/>
  </action-method>

  <action-group name="action-invoice-line-group-set-total-gst-amount">
  <action name="action-invoice-product-record-set-net-amount"/>
  <action name="action-invoice-line-method-calculate-amounts"/>
  </action-group>
  
  <action-condition name="action-invoice-line-condition-check-product-is-empty">
  <check field="product"/>
  <check field="gstRate"/>
  <check field="qty"/>
  <check field="product" error="pls select any product" if="!product"/>
  <check field="gstRate" error="gst rate is not set" if="!gstRate"/>
  <check field="qty" error="pls select quantity" if="!qty"/>
  </action-condition>
  
</object-views>
